# tests/testthat/test-get-plot-code.R

test_that("get_plot_code returns correct history", {
  p <- ggplot(mtcars, aes(x = wt, y = mpg)) + geom_point()
  plot_code <- get_plot_code(p)
  expect_true(inherits(plot_code, "ggplot_history_code"))
  expect_length(plot_code, 2)
})

test_that("eval_plot_code reproduces the plot", {
  p <- ggplot(mtcars, aes(x = wt, y = mpg)) + geom_point()
  plot_code <- get_plot_code(p)
  reconstructed_plot <- eval_plot_code(plot_code)
  expect_true(inherits(reconstructed_plot, "ggplot"))
  expect_length(attr(reconstructed_plot, "plot_history"), 2)
})